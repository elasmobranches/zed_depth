# ArUco 마커 기반 ZED Depth 검증

ZED 카메라의 depth 정확도를 ArUco 마커로 검증하는 도구입니다.

## 📁 파일 구조

```
aruco_validation/
├── capture_aruco.py         # 메인 검증 프로그램
├── marker_config.yaml       # 마커 설정 파일
└── results/                 # 검증 결과 (CSV, 이미지)
```

## 🚀 사용 순서

### 1단계: 마커 배치

1. **배치**: 기존 ArUco 마커를 해당 거리에 배치
   - ID 0 → 1m
   - ID 1 → 2m
   - ID 2 → 3m
   - ID 3 → 5m

2. **거리 측정**: 
   - 줄자로 **카메라 렌즈 중심** ~ **마커 중심** 거리를 정확히 측정
   - 측정한 거리를 `marker_config.yaml`에 기록

### 2단계: 검증 실행

```bash
python3 capture_aruco.py
```

**키보드 조작**:
- `s` - 현재 프레임의 마커 정보 저장
- `q` - 종료

**측정 팁**:
- 각 마커당 10~20회 저장 권장
- 다양한 각도에서 측정하면 더 정확함
- 마커가 화면에 잘 보이는지 확인

### 3단계: 결과 확인

종료 후 자동으로 요약이 출력됩니다:

```
============================================================
결과 요약
============================================================

[마커별 평균 오차]
  ID 0 (1.0m): 2.15% ± 0.32% (n=15)
  ID 1 (2.0m): 2.34% ± 0.41% (n=15)
  ID 2 (3.0m): 3.12% ± 0.58% (n=15)
  ID 3 (5.0m): 3.67% ± 0.73% (n=15)

[전체 통계]
  평균 오차: 2.82%
  표준편차: 0.78%
  최소 오차: 1.23%
  최대 오차: 4.89%
  측정 횟수: 60회
============================================================
```

결과 파일은 `results/` 폴더에 저장됩니다:
- `aruco_validation_YYYYMMDD_HHMMSS.csv` - 측정 데이터
- `capture_YYYYMMDD_HHMMSS.jpg` - 캡처 이미지

## 📊 CSV 결과 형식

```csv
timestamp,marker_id,pixel_x,pixel_y,actual_mm,zed_mm,error_mm,error_pct
2025-12-03 16:00:00,0,960,540,1000.0,1021.3,21.3,2.13
2025-12-03 16:00:05,1,850,520,2000.0,2046.8,46.8,2.34
...
```

## 🎨 화면 표시

### 오차에 따른 색상

- 🟢 **녹색**: 오차 < 3% (우수)
- 🟡 **노란색**: 3% ≤ 오차 < 5% (보통)
- 🔴 **빨간색**: 오차 ≥ 5% (나쁨)

### 표시 정보

각 마커마다 다음 정보가 표시됩니다:
- 마커 ID
- 실제 거리
- ZED 측정 거리
- 오차 비율

## ⚙️ 설정 수정

`marker_config.yaml` 파일을 수정하여 마커를 추가/변경할 수 있습니다:

```yaml
markers:
  0: 1.0    # ID 0 = 1m
  1: 2.0    # ID 1 = 2m
  2: 3.0    # ID 2 = 3m
  3: 5.0    # ID 3 = 5m
  4: 7.0    # ID 4 = 7m (새로 추가)

marker_size: 150    # 마커 크기 (mm)
aruco_dict: DICT_4X4_50  # ArUco Dictionary
```

## 🔧 고급 기능

### Depth 측정 방식

- **5x5 윈도우 중앙값** 사용
- 노이즈 제거 및 안정적인 측정
- NaN, Inf 값 자동 제외

### 지원하는 ArUco Dictionary

- `DICT_4X4_50` (기본값, 50개 마커)
- `DICT_5X5_50`
- `DICT_6X6_50`
- `DICT_7X7_50`

## 📝 논문 작성 예시

측정 결과를 바탕으로 다음과 같이 작성할 수 있습니다:

> "ZED 2i 카메라의 depth 정확도를 검증하기 위해 ArUco 마커 기반 검증 실험을 수행하였다. 
> 1m, 2m, 3m, 5m 거리에 마커를 배치하고 각 거리당 15회씩 측정한 결과, 
> 평균 오차 2.82% (표준편차 0.78%)를 보였다. 
> 특히 5m 이내 거리에서는 평균 3.0% 미만의 오차를 보여 
> 실내 환경에서의 depth 추정이 충분히 신뢰할 수 있는 수준임을 확인하였다."

## 🆘 문제 해결

### 마커가 검출되지 않음

- 조명 확인 (너무 어둡거나 밝으면 안 됨)
- 마커가 찌그러지지 않았는지 확인
- 카메라와 마커가 평행한지 확인
- 출력 품질 확인 (선명하게 출력되어야 함)

### Depth가 NaN으로 나옴

- 마커 표면이 반사되는 재질인지 확인
- 거리가 너무 가깝거나 멀지 않은지 확인 (0.3m ~ 20m)
- ZED depth mode 확인 (NEURAL_PLUS 권장)

### 오차가 너무 큼

- 거리 측정을 다시 확인 (카메라 렌즈 ~ 마커 중심)
- 마커가 벽에 평평하게 붙어있는지 확인
- 카메라 캘리브레이션 확인

## 📚 참고

- [ArUco 마커 생성 사이트](https://chev.me/arucogen/)
- [OpenCV ArUco 문서](https://docs.opencv.org/4.x/d5/dae/tutorial_aruco_detection.html)
- [ZED SDK 문서](https://www.stereolabs.com/docs/)

## 💡 Tip

- 마커는 무광 용지에 출력하는 것이 좋습니다 (반사 방지)
- 실험 환경(조명, 온도 등)을 기록해두세요
- 여러 번 측정해서 평균을 내면 더 정확합니다
- 카메라를 삼각대에 고정하면 일관된 측정이 가능합니다

